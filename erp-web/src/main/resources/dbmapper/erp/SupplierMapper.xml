<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.skyeye.dao.SupplierDao">
    <select id="querySupplierByList" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
            s.id,
            s.supplier supplierName,
            s.contacts,
            s.phonenum,
            s.email,
            s.description,
            s.isystem,
            s.type supplierType,
            s.enabled,
            s.advance_in advanceIn,
            s.begin_need_get beginNeedGet,
            s.begin_need_pay beginNeedPay,
            s.all_need_get allNeedGet,
            s.all_need_pay allNeedPay,
            s.fax,
            s.tax_rate taxRate,
            s.telephone,
            CONVERT (s.create_time, CHAR) createTime
        FROM
            erp_supplier s
        WHERE
            s.delete_flag = 0
        AND
            s.tenant_id = #{userId}
        <if test="supplierName != '' and supplierName != null">
        AND
            s.supplier LIKE '%${supplierName}%'
        </if>
        <if test="phonenum != '' and phonenum != null">
            AND
            s.phonenum LIKE '%${phonenum}%'
        </if>
        <if test="telephone != '' and telephone != null">
            AND
            s.telephone LIKE '%${telephone}%'
        </if>
        ORDER BY s.create_time DESC
    </select>

    <select id="querySupplierByUserIdAndSupplier" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
            s.id,
            s.supplier supplierName,
            s.contacts,
            s.phonenum,
            s.email,
            s.description,
            s.isystem,
            s.type supplierType,
            s.enabled
        FROM
            erp_supplier s
        WHERE
            s.tenant_id = #{userId}
        AND
            s.supplier = #{supplierName}
        AND
            s.delete_flag = 0
        ORDER BY s.id DESC LIMIT 0,1
    </select>

    <insert id="insertSupplier" parameterType="java.util.Map">
        INSERT INTO erp_supplier(
            <if test="contacts != '' and contacts != null">
                contacts,
            </if>
            <if test="phonenum != '' and phonenum != null">
                phonenum,
            </if>
            <if test="email != '' and email != null">
                email,
            </if>
            <if test="description != '' and description != null">
                description,
            </if>
            <if test="advanceIn != '' and advanceIn != null">
                advance_in,
            </if>
            <if test="beginNeedGet != '' and beginNeedGet != null">
                begin_need_get,
            </if>
            <if test="beginNeedPay != '' and beginNeedPay != null">
                begin_need_pay,
            </if>
            <if test="allNeedGet != '' and allNeedGet != null">
                all_need_get,
            </if>
            <if test="allNeedPay != '' and allNeedPay != null">
                all_need_pay,
            </if>
            <if test="fax != '' and fax != null">
                fax,
            </if>
            <if test="telephone != '' and telephone != null">
                telephone,
            </if>
            <if test="address != '' and address != null">
                address,
            </if>
            <if test="taxNum != '' and taxNum != null">
                tax_num,
            </if>
            <if test="bankName != '' and bankName != null">
                bank_name,
            </if>
            <if test="accountNumber != '' and accountNumber != null">
                account_number,
            </if>
            <if test="taxRate != '' and taxRate != null">
                tax_rate,
            </if>
            supplier,
            isystem,
            type,
            enabled,
            tenant_id,
            delete_flag,
            create_time
        ) VALUES (
            <if test="contacts != '' and contacts != null">
                #{contacts},
            </if>
            <if test="phonenum != '' and phonenum != null">
                #{phonenum},
            </if>
            <if test="email != '' and email != null">
                #{email},
            </if>
            <if test="description != '' and description != null">
                #{description},
            </if>
            <if test="advanceIn != '' and advanceIn != null">
                #{advanceIn},
            </if>
            <if test="beginNeedGet != '' and beginNeedGet != null">
                #{beginNeedGet},
            </if>
            <if test="beginNeedPay != '' and beginNeedPay != null">
                #{beginNeedPay},
            </if>
            <if test="allNeedGet != '' and allNeedGet != null">
                #{allNeedGet},
            </if>
            <if test="allNeedPay != '' and allNeedPay != null">
                #{allNeedPay},
            </if>
            <if test="fax != '' and fax != null">
                #{fax},
            </if>
            <if test="telephone != '' and telephone != null">
                #{telephone},
            </if>
            <if test="address != '' and address != null">
                #{address},
            </if>
            <if test="taxNum != '' and taxNum != null">
                #{taxNum},
            </if>
            <if test="bankName != '' and bankName != null">
                #{bankName},
            </if>
            <if test="accountNumber != '' and accountNumber != null">
                #{accountNumber},
            </if>
            <if test="taxRate != '' and taxRate != null">
                #{taxRate},
            </if>
            #{supplierName},
            #{isystem},
            #{supplierType},
            #{enabled},
            #{userId},
            #{deleteFlag},
            #{createTime}
        )
    </insert>

    <select id="querySupplierById" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
            s.id,
            s.supplier supplierName,
            s.contacts,
            s.phonenum,
            s.email,
            s.description,
            s.isystem,
            s.type supplierType,
            s.enabled,
            s.advance_in advanceIn,
            s.begin_need_get beginNeedGet,
            s.begin_need_pay beginNeedPay,
            s.all_need_get allNeedGet,
            s.all_need_pay allNeedPay,
            s.fax,
            s.tax_rate taxRate,
            s.address,
            s.telephone,
            s.tax_num taxNum,
            s.bank_name bankName,
            s.account_number accountNumber
        FROM
            erp_supplier s
        WHERE
            s.tenant_id = #{userId}
        AND
            s.id = #{id}
        ORDER BY s.id DESC LIMIT 0,1
    </select>

    <update id="editSupplierByDeleteFlag" parameterType="java.util.Map">
        UPDATE erp_supplier
        <set>
            delete_flag = #{deleteFlag},
        </set>
        WHERE
            tenant_id = #{userId}
        AND
            id = #{id}
    </update>

    <update id="editSupplierById" parameterType="java.util.Map">
        UPDATE erp_supplier
        <set>
            <if test="supplierName != '' and supplierName != null">
                supplier = #{supplierName},
            </if>
            <if test="contacts != '' and contacts != null">
                contacts = #{contacts},
            </if>
            <if test="phonenum != '' and phonenum != null">
                phonenum = #{phonenum},
            </if>
            <if test="email != '' and email != null">
                email = #{email},
            </if>
            <if test="description != '' and description != null">
                description = #{description},
            </if>
            <if test="isystem != '' and isystem != null">
                isystem = #{isystem},
            </if>
            <if test="supplierType != '' and supplierType != null">
                type = #{supplierType},
            </if>
            <if test="enabled != '' and enabled != null">
                enabled = #{enabled},
            </if>
            <if test="advanceIn != '' and advanceIn != null">
                advance_in = #{advanceIn},
            </if>
            <if test="beginNeedGet != '' and beginNeedGet != null">
                begin_need_get = #{beginNeedGet},
            </if>
            <if test="beginNeedPay != '' and beginNeedPay != null">
                begin_need_pay = #{beginNeedPay},
            </if>
            <if test="allNeedGet != '' and allNeedGet != null">
                all_need_get = #{allNeedGet},
            </if>
            <if test="allNeedPay != '' and allNeedPay != null">
                all_need_pay = #{allNeedPay},
            </if>
            <if test="fax != '' and fax != null">
                fax = #{fax},
            </if>
            <if test="telephone != '' and telephone != null">
                telephone = #{telephone},
            </if>
            <if test="address != '' and address != null">
                address = #{address},
            </if>
            <if test="taxNum != '' and taxNum != null">
                tax_num = #{taxNum},
            </if>
            <if test="bankName != '' and bankName != null">
                bank_name = #{bankName},
            </if>
            <if test="accountNumber != '' and accountNumber != null">
                account_number = #{accountNumber},
            </if>
            <if test="taxRate != '' and taxRate != null">
                tax_rate = #{taxRate},
            </if>
        </set>
        WHERE
            tenant_id = #{userId}
        AND
            id = #{id}
    </update>
    
    <update id="editSupplierByEnabled" parameterType="java.util.Map">
        UPDATE erp_supplier
        <set>
            enabled = #{enabled}
        </set>
        WHERE
            tenant_id = #{userId}
        AND
            id = #{id}
    </update>

    <update id="editSupplierByNotEnabled" parameterType="java.util.Map">
        UPDATE erp_supplier
        <set>
            enabled = #{enabled}
        </set>
        WHERE
            tenant_id = #{userId}
        AND
            id = #{id}
    </update>
</mapper>